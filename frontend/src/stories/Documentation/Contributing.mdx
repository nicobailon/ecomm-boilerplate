import { Meta } from '@storybook/addon-docs/blocks';

<Meta title="Documentation/Contributing" />

# Contributing to Storybook

This guide outlines the conventions and best practices for creating stories in our Storybook setup.

## Story Taxonomy

We use a hierarchical naming convention to organize our components:

### UI Components
- **UI/Primitives** - Basic form inputs and controls
  - Input, Select, Checkbox, Switch, etc.
- **UI/Navigation** - Navigation components
  - Tabs, Breadcrumb, etc.
- **UI/Overlay** - Components that overlay content
  - AlertDialog, Dropdown, Modal, etc.
- **UI/Controls** - Interactive controls
  - ThemeToggle, etc.
- **UI/Feedback** - User feedback components
  - Toast, Alert, Progress, etc.
- **UI/Layout** - Layout components
  - Grid, Container, etc.

### Feature Components
- **Features/Product** - Product-related components
- **Features/Cart** - Shopping cart components
- **Features/Auth** - Authentication components
- **Features/Admin** - Admin panel components

## File Naming Conventions

### Story Files
- Story files should be co-located with their components
- Use the format: `ComponentName.stories.tsx`
- Example: `Button.stories.tsx`

### Component Files
- Component files use the format: `ComponentName.tsx`
- Example: `Button.tsx`

## Writing Stories

### Basic Story Structure

```typescript
import type { Meta, StoryObj } from '@storybook/react';
import { ComponentName } from './ComponentName';

const meta = {
  title: 'UI/Category/ComponentName',
  component: ComponentName,
  parameters: {
    layout: 'centered', // or 'fullscreen', 'padded'
  },
  tags: ['autodocs'],
  argTypes: {
    // Define controls for props
  },
} satisfies Meta<typeof ComponentName>;

export default meta;
type Story = StoryObj<typeof meta>;

export const Default: Story = {
  args: {
    // Default props
  },
};
```

### Common Story Patterns

#### 1. Basic States
Always include these basic stories when applicable:
- Default
- Disabled
- Loading/Pending
- Error
- Success

#### 2. Interactive Stories
```typescript
export const Interactive: Story = {
  render: () => {
    const [state, setState] = useState(initialValue);
    
    return (
      <Component 
        value={state}
        onChange={setState}
      />
    );
  },
};
```

#### 3. Grouped Examples
```typescript
export const AllVariants: Story = {
  render: () => (
    <div className="space-y-4">
      <Component variant="primary" />
      <Component variant="secondary" />
      <Component variant="destructive" />
    </div>
  ),
};
```

## Play Function Tests

Use play functions to test component interactions:

```typescript
import { within, expect } from '@testing-library/react';
import userEvent from '@testing-library/user-event';

export const WithInteraction: Story = {
  args: {
    label: 'Click me',
  },
  play: async ({ canvasElement }) => {
    const canvas = within(canvasElement);
    
    // Find element
    const button = canvas.getByRole('button');
    
    // Test interaction
    await userEvent.click(button);
    
    // Assert result
    await expect(button).toHaveAttribute('aria-pressed', 'true');
  },
};
```

### Common Play Function Patterns

#### Testing Form Inputs
```typescript
play: async ({ canvasElement }) => {
  const canvas = within(canvasElement);
  const input = canvas.getByRole('textbox');
  
  // Type text
  await userEvent.type(input, 'Hello World');
  
  // Verify value
  await expect(input).toHaveValue('Hello World');
  
  // Clear input
  await userEvent.clear(input);
  await expect(input).toHaveValue('');
}
```

#### Testing Keyboard Navigation
```typescript
play: async ({ canvasElement }) => {
  const canvas = within(canvasElement);
  const element = canvas.getByRole('button');
  
  // Focus element
  await element.focus();
  
  // Test keyboard interaction
  await userEvent.keyboard('{Space}');
  await userEvent.keyboard('{Enter}');
  await userEvent.keyboard('{Escape}');
}
```

## Accessibility Testing

### Local Accessibility Checks

1. **Use the A11y Addon**: Check the Accessibility panel in Storybook
2. **Keyboard Navigation**: Test all interactive elements with keyboard only
3. **Screen Reader**: Test with screen reader announcements
4. **Color Contrast**: Verify sufficient contrast ratios

### Story-Level A11y Configuration

```typescript
export const AccessibleStory: Story = {
  parameters: {
    a11y: {
      config: {
        rules: [
          { id: 'color-contrast', enabled: true },
          { id: 'label', enabled: true },
          { id: 'button-name', enabled: true },
        ],
      },
    },
  },
};
```

### Common A11y Patterns

#### Form Labels
```tsx
<label htmlFor="input-id">Label Text</label>
<input id="input-id" />
```

#### ARIA Attributes
```tsx
<button
  aria-label="Close dialog"
  aria-pressed={isPressed}
  aria-expanded={isExpanded}
  aria-controls="panel-id"
/>
```

#### Live Regions
```tsx
<div aria-live="polite" aria-atomic="true">
  Status updates here
</div>
```

## Best Practices

### 1. Story Organization
- Group related stories together
- Use clear, descriptive story names
- Order stories from simple to complex

### 2. Documentation
- Use JSDoc comments for complex props
- Include usage examples in stories
- Document edge cases and limitations

### 3. Testing
- Write play functions for interactive components
- Test error states and edge cases
- Verify keyboard navigation

### 4. Performance
- Lazy load heavy components
- Minimize story dependencies
- Use realistic but minimal mock data

### 5. Consistency
- Follow the established taxonomy
- Use consistent prop names
- Maintain similar story structures

## Checklist for New Stories

Before submitting a new story, ensure:

- [ ] Component follows the naming taxonomy
- [ ] Basic states are covered (default, disabled, etc.)
- [ ] Interactive stories demonstrate key features
- [ ] Play functions test critical interactions
- [ ] Accessibility requirements are met
- [ ] Story renders correctly in all themes
- [ ] Props are properly typed and documented
- [ ] No console errors or warnings

## Running Storybook

```bash
# Start development server
npm run storybook

# Build static Storybook
npm run build-storybook

# Run story tests
npm run test-storybook
```

## Troubleshooting

### Common Issues

1. **Import Errors**: Ensure path aliases are configured
2. **Theme Issues**: Check ThemeProvider wrapper
3. **Test Failures**: Verify element selectors and timing
4. **A11y Violations**: Review accessibility panel output

### Getting Help

- Check existing stories for examples
- Review the Storybook documentation
- Ask in the team chat for guidance

## Resources

- [Storybook Documentation](https://storybook.js.org/docs)
- [Testing Library](https://testing-library.com/)
- [ARIA Authoring Practices](https://www.w3.org/WAI/ARIA/apg/)
- [WCAG Guidelines](https://www.w3.org/WAI/WCAG21/quickref/)